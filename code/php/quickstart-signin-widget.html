<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
<head>
  <script>
    var isProduction = window.location.hostname === 'developer.okta.com';
    if (isProduction) {
      // TypeKit
      (function(d) {
        var config = {
          kitId: 'jff5neq',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);

      // Google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-15777010-3', 'auto');
      ga('send', 'pageview');

      // START Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TJ45R6');
      // END Google Tag Manager
    }
	</script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
 	
  <link type="text/css" rel="stylesheet" href="/assets/animate-ec43d72c3ed45e08a460b8a2966d8dba6006aebfa0530935c3973fa493a8771f.css">
  <link type="text/css" rel="stylesheet" href="/assets/okta-fe3337502d4360bcb36814ced8dd4f88ec4c9e7d7a0be6fa2995c3524314aa7d.css">
  
  
  <link rel="shortcut icon" type="image/vnd.microsoft.icon" href="/favicon.ico">
  <title>Okta Sign-In Widget | Okta Developer</title>
  <meta name="description" content="Quickstart guide for using the Okta Sign-In Widget with PHP.">
  <link rel="canonical" href="https://developer.okta.com/code/php/quickstart-signin-widget">
  <link rel="alternate" type="application/rss+xml" title="Okta Developer" href="https://developer.okta.com/feed.xml"><!-- GA -->
</head>

<body>
  <div class="Page okta-sign-in-widget">
    <!-- START Header -->
    
<header id="header">
      <div class="Wrap">
        <h1 class="logo"><a href="/">Okta</a></h1><!-- START Primary Nav -->
        <nav>
          <div id="top-nav">
            <a href="#" id="mobile-close" class="mobile-toggle">
              <span></span>
              <span></span>
            </a>
            <a class="Button--green" href="https://developer.okta.com/signup/" id="top-nav-cta">Get Started</a>
            <a class="SearchIcon" href="#"></a>
            <ul>
              <li>
                <a href="/product/">Product</a>
              </li>
              <li>
                <a href="/documentation/">Documentation</a>
              </li>
              <li>
                <a href="/code/">Code</a>
              </li>
              <li class="has-dropdown">
                <a href="#">Support</a>
                <div class="dropdown-window">
                  <p class="devforum">Post your question on <a href="https://devforum.okta.com/" title="Okta Developer Forums" target="_blank">Okta Developer Forums</a></p>
                  <p class="email">Email us:<br>
                  <a href="mailto:developers@okta.com">developers@okta.com</a></p>
                  <p class="tel">Call us:<br>
                  <a href="tel:18887227871">1 (888) 722-7871</a></p>
                </div>
              </li>
            </ul>
            <form id="form_search" method="get" action="/search/" name="form_search">
              <input type="text" name="q" id="q" autocomplete="off">
            </form>
          </div>
          <div id="mobile-nav">
            <a id="mobile-search" href="/search/"><span class="icon-search-light"></span></a>
            <a id="mobile-open" class="mobile-toggle" href="#top-nav">
              <span></span>
              <span></span>
              <span></span>
            </a>
          </div>
        </nav><!-- END Primary Nav -->
      </div>
    </header>

    <!-- END Header -->
     <!-- START Page Center w/Sub Nav & Content -->
    <section class="PageContent DynamicSidebar has-tableOfContents">
      <!-- START Fixed sidebar --><aside class="Sidebar">
        <h2 class="Sidebar-location Sidebar-toggle h6">Navigation</h2>
        <div class="Sidebar-close Sidebar-toggle"></div>
        <div>
          <h3 class="Sidebar-title">Use Cases</h3>
          <ul class="Sidebar-nav">
            <li>
              <a href="/use_cases/authentication/">Authentication</a>
            </li>
            <li>
              <a href="/use_cases/mfa/">Multi-Factor Authentication</a>
            </li>
            <li>
              <a href="/use_cases/api_access_management/">API Access Management</a>
            </li>
            <li>
              <a href="/use_cases/integrate_with_okta/">Integrate with Okta</a>
            </li>
          </ul>
          <h3 class="Sidebar-title">Reference</h3>
          <ul class="Sidebar-nav">
            <li>
              <a href="/docs/api/getting_started/api_test_client.html">Getting Started</a>
            </li>
            <li>
              <a href="/docs/api/resources/authn.html">Authentication Reference</a>
            </li>
            <li>
              <a href="/docs/api/resources/apps.html">API Reference</a>
            </li>
            <li>
              <a href="/reference/error_codes/">Error Codes</a>
            </li>
            <li>
              <a href="/reference/okta_expression_language/">Okta Expression Language</a>
            </li>
            <li>
              <a href="/docs/platform-release-notes/platform-release-notes.html">Platform Release Notes</a>
            </li>
          </ul>

          <h3 class="Sidebar-title">Standards</h3>
          <ul class="Sidebar-nav">
            
            
            
            <li>
              <a href="/standards/OAuth/">OAuth 2.0 and Okta</a>
            </li>
            
            
            <li>
              <a href="/standards/OIDC/">OpenID Connect and Okta</a>
            </li>
            
            
            <li>
              <a href="/standards/SAML/">SAML</a>
            </li>
            
            
            
            
            <li>
              <a href="/standards/SCIM/">SCIM Provisioning with Lifecycle Management</a>
            </li>
            
          </ul>
          <script>
            if (document.querySelectorAll("#Sidebar_Resources .is-active").length) {
                document.getElementById('Sidebar_Resources').classList.remove('Sidebar-hide');
            }

            if (document.querySelectorAll("#Sidebar_References .is-active").length) {
                document.getElementById('Sidebar_References').classList.remove('Sidebar-hide');
            }
          </script>
        </div>
      </aside>
<!-- END Fixed sidebar -->
      <!-- START Page Content -->
      <div class="PageContent-main" id="docs-body">
        <a id="edit-link" href="https://github.com/okta/okta.github.io/edit/master/_source/_code/php/quickstart-signin-widget.md">Edit Page</a>
      <h1 id="overview">Overview</h1>
<p>The Okta Sign-In Widget is a JavaScript widget from Okta that gives you a fully featured and customizable login experience which can be used to authenticate users on any web site.</p>

<p><img src="/assets/okta-signin-da15ebe650d0258b247d4981a956abec094e9891c0b7f9e2ce7c5731f103d6be.png" alt="Screenshot of basic Okta Sign-In Widget" /></p>

<h1 id="configuring-your-organization">Configuring your Organization</h1>
<p>There are some steps to prepare for the use of the Okta Sign-In Widget. We need to sign up for Okta, set up CORS
and create an authorization server. Use this guide to get up and running with our customizable Okta Sign-In Widget.</p>

<h2 id="sign-up-for-okta">Sign-up for Okta</h2>
<ol>
  <li>Go to <a href="">https://www.okta.com/developer/signup/</a> and complete the form.</li>
  <li>After submitting the form, you are presented with your Okta URL. Make note of this URL, you will need it later. You
will also receive an confirmation email.</li>
  <li>Once you click on the sign-in link in your email, Okta finishes provisioning your account for you. Sign in with the
 password provided in the email.</li>
  <li>Follow the remaining steps for account creation on the form provided after logging in and then click <strong>Create My
Account</strong></li>
</ol>

<p>After your are finished creating your account, you will be logged into your new organization. In the top right of the
 screen, there is an <strong>Admin</strong> button.
Clicking on the <strong>Admin</strong> button will take you to your Okta Administration Dashboard and this is where we’ll be
spending
most of our time during this guide. For the remainder of this quickstart, we’re going to assume the domain for your
organization will be <code class="highlighter-rouge">dev-123456.oktapreview.com</code>. For your application, you’ll want to change this url to match your own organizations url.</p>

<h2 id="enable-cors-for-your-domain">Enable CORS for your Domain</h2>
<p>This step is necessary for Okta to accept authentication requests from an application through the Sign-In Widget.</p>

<p>You can enable CORS by following the steps in our <a href="/docs/api/getting_started/enabling_cors.html">guide for Enabling CORS</a>. Configure CORS using the same base URL as the web server you are
using to host the HTML for the Okta Sign-In Widget (see below for instructions). For our example, we’ll be setting
our example to be hosted on <code class="highlighter-rouge">http://localhost:8000</code>. We’ll need to add <code class="highlighter-rouge">http://localhost:8000</code> as a trusted CORS
endpoint in Okta.</p>

<p>To do so, follow the steps below:</p>
<ol>
  <li>Navigate to <strong>Admin -&gt; Security -&gt; API</strong> on your Okta dashboard.</li>
  <li>In the <strong>Trusted Origins</strong> tab, click on <strong>Add Origin</strong>. This will open a modal window with a form to fill out.</li>
  <li>Give your new origin a name, we will use <strong>PHP Sign-In Widget Example</strong> as ours.</li>
  <li>In the Origin URL field, fill in your web server that you are hosting on, we’ll use <code class="highlighter-rouge">http://localhost:8000</code>.</li>
  <li>Check <strong>CORS</strong> in the <strong>Type</strong> section and then click <strong>Save</strong></li>
</ol>

<h2 id="create-an-authorization-server">Create an Authorization Server</h2>
<p>An authorization server defines your security boundary, for example “staging” or “production”. Within each
authorization server you can define your own OAuth scopes, claims, and access policies. This allows your apps and APIs to anchor to a central authorization point and leverage the rich identity features of Okta, such as
Universal Directory for transforming attributes, adaptive MFA for end-users, analytics, and system log.</p>

<p>We will need to set up our own authorization server for our example. This is what the Sign-In Widget will communicate
with to handle the user authentication services. To set this up, follow the steps below:</p>
<ol>
  <li>Navigate to <strong>Admin -&gt; Security -&gt; API</strong> page of your Okta dashboard.</li>
  <li>Select the Authorization Servers tab if not already selected.</li>
  <li>Click on <strong>Add Authorization Server</strong>. This will open a modal window with a form to fill out.</li>
  <li>Fill in the form with your information. For our example, we will be using the following:
    <ul>
      <li>Name: PHP Sign-In Widget Example - Develop</li>
      <li>Resource URI: http://localhost:8000
        <ul>
          <li>This is the URI for the OAuth resource that consumes the Access Tokens.</li>
          <li>This value is used as the default
 audience for Access Tokens</li>
        </ul>
      </li>
      <li>Description: This is the development site for our Sign-In Widget example in PHP.</li>
    </ul>
  </li>
  <li>Click <strong>Save</strong></li>
</ol>

<h2 id="create-an-access-policy">Create an Access Policy</h2>
<p>Our new authorization server needs to have an access policy, so it knows how to handle its users. To
create a new policy, follow the steps below:</p>

<ol>
  <li>Navigate to <strong>Admin -&gt; Security -&gt; API</strong> page of your Okta dashboard.</li>
  <li>Select the Authorization Servers tab if not already selected.</li>
  <li>Choose the name of the authorization server we created, or the one you want to add a policy to.</li>
  <li>Click on <strong>Access Policies &gt; Add Policy</strong>. If you already have a policy, you may see <strong>Add New Access Policy</strong>
instead of <strong>Add Policy</strong>. This
will open a model window with a form to fill out.</li>
  <li>Provide the requested information. For our example, we will be using the following:
    <ul>
      <li>Name: Policy 1</li>
      <li>Description: Primary Policy for the PHP Sign-In Widget Example</li>
      <li>Assign To: All Clients</li>
    </ul>
  </li>
</ol>

<h3 id="add-a-rule-to-new-policy">Add a Rule to New Policy</h3>
<p>For your new policy that we just created, we’ll need to add a rule to tell the policy how to function.</p>

<ol>
  <li>Navigate to <strong>Admin -&gt; Security -&gt; API -&gt; Access Policies</strong> page of your Okta dashboard.</li>
  <li>Select the policy we just created <strong>Policy 1</strong>.</li>
  <li>Click on <strong>Add Rule</strong>. This will open a modal window with a form to fill out.</li>
  <li>Provide the requested information. For our example, we will be using the following:
    <ul>
      <li>Rule Name: Primary Rule</li>
      <li>Grant type is:
        <ul>
          <li>Client credentials</li>
          <li>Authorization code</li>
          <li>Implicit</li>
          <li>Resource Owner Password</li>
        </ul>
      </li>
      <li>User is: Any user assigned to app</li>
      <li>Grant these scopes: ALl Scopes</li>
      <li>Access token lifetime is: 1 Hour</li>
      <li>Refresh token lifetime is: Unlimited
        <ul>
          <li>but will expire: 7 days</li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<h2 id="create-your-application">Create your application</h2>
<p>Now that we have our access policy set up, we need an application to communicate with. This is the application that
will represent the application the Widget signs users into. To create an application, follow the steps below:</p>

<ol>
  <li>Navigate to <strong>Admin -&gt; Applications</strong> page of your Okta dashboard.</li>
  <li>Click <strong>Add Application</strong>. This will take you to the add application page, we will select the button <strong>Create New
App</strong> instead of selecting a pre-defined one. This will open a modal window and give you a few options. We’ll be using
 the following:
    <ul>
      <li>Platform: Web</li>
      <li>Sign on method: OpenID Connect</li>
    </ul>
  </li>
  <li>For the general settings page, we’ll be using the following:
    <ul>
      <li>Application Name: PHP Sign-In Widget</li>
      <li>Application Logo: none</li>
    </ul>
  </li>
  <li>Click <strong>Next</strong> and then we will be configuring OpenID connect:
    <ul>
      <li>Redirect URIs: <code class="highlighter-rouge">http://localhost:8000/oauth2-callback.php</code></li>
    </ul>
  </li>
  <li>Click <strong>Finish</strong></li>
  <li>In the <strong>General</strong> tab of the application you just created, we need to add a few <strong>Allowed grant types</strong>. Click <strong>Edit</strong>
 of the <strong>General Settings</strong> area and make sure you select <strong>Implicit (Hybrid)</strong> which will give you the option to select
  <strong>Allow Access Token with implicit grant type</strong>. Select that and then click <strong>Save</strong>.</li>
</ol>

<p>Make note of the Client ID from the <strong>Client Credentials</strong> section as we will need this when we set up the widget in
our application.</p>

<h3 id="assigning-groups-to-the-application">Assigning Groups to the Application</h3>
<p>The last part of the application setup is setting up group access.</p>

<ol>
  <li>Navigate to <strong>Admin -&gt; Applications</strong> page of your Okta dashboard and select the application we just created.</li>
  <li>Select the <strong>Groups</strong> tab.</li>
  <li>Click on <strong>Assign to Groups</strong>. This will open a model window with all groups associated with your organization.</li>
  <li>Find <strong>Everyone</strong> in this list and click <strong>Assign</strong>.  You can limit this to only certain groups by selecting on those
groups instead of <strong>Everyone</strong>.</li>
  <li>Click <strong>Done</strong></li>
</ol>

<h1 id="php-application-set-up">PHP Application Set-up</h1>
<p>Now that we have all the configuration at Okta done, we can begin setting up our PHP application. There are a
couple of different ways to include the sign-in widget in your application. You can use the NPM module by installing
<code class="highlighter-rouge">@okta/okta-signin-widget</code> in your project, or by using the Okta CDN, which is what we’ll be using. Once you have the
 sign-in widget, there’s a little bit of configuration you have to do to talk with your new authorization server.</p>

<h2 id="installing-and-configuring-the-sign-in-widget">Installing and Configuring the Sign In Widget</h2>
<p>There are 2 files we will require for the sign in widget to work, a JS file and a CSS file. You will also be able to
supply a 3rd file from our CDN or supply your own for the theme of the signin widget.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- Latest CDN production Javascript and CSS: 1.13.0 --&gt;</span>
<span class="nt">&lt;script
  </span><span class="na">src=</span><span class="s">"https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/1.13.0/js/okta-sign-in.min.js"</span>
  <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;link</span>
  <span class="na">href=</span><span class="s">"https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/1.13.0/css/okta-sign-in.min.css"</span>
  <span class="na">type=</span><span class="s">"text/css"</span>
  <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">/&gt;</span>

<span class="c">&lt;!-- Theme file: Customize or replace this file if you want to override our default styles --&gt;</span>
<span class="nt">&lt;link</span>
  <span class="na">href=</span><span class="s">"https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/1.13.0/css/okta-theme.css"</span>
  <span class="na">type=</span><span class="s">"text/css"</span>
  <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">/&gt;</span>
</code></pre>
</div>
<p>Add the above to your login page. For our example, we will be using <code class="highlighter-rouge">login.php</code> as our login page. Also on the login
page, we need to add a little bit of configuration for the sign-in widget to work. The first thing is to create an
area on the page to give us a target for the widget to be placed.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"okta-login"</span><span class="nt">&gt;&lt;/div&gt;</span>
</code></pre>
</div>

<blockquote>
  <p>This element, a div in our example, should remain empty and can be placed where you would like the sign-in widget
to be rendered..</p>
</blockquote>

<p>We also need to add a script block to initialize and configure the widget.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">orgUrl</span> <span class="o">=</span> <span class="s1">'https://dev-123456.oktapreview.com'</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">signIn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OktaSignIn</span><span class="p">({</span>
        <span class="na">baseUrl</span><span class="p">:</span> <span class="nx">orgUrl</span><span class="p">,</span>
        <span class="na">clientId</span><span class="p">:</span> <span class="s1">'sRmBpCfR3xKyf4goHZhM'</span><span class="p">,</span>
        <span class="na">redirectUri</span><span class="p">:</span> <span class="s1">'http://localhost:8000/oauth2-callback.php'</span><span class="p">,</span>
        <span class="na">authParams</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">responseType</span><span class="p">:</span> <span class="s1">'access_token'</span><span class="p">,</span>
            <span class="na">issuer</span><span class="p">:</span> <span class="s1">'https://dev-123456.oktapreview.com/oauth2/ausa87h9g2misxHVS0h7'</span><span class="p">,</span>
            <span class="na">display</span><span class="p">:</span> <span class="s1">'page'</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">signIn</span><span class="p">.</span><span class="nx">renderEl</span><span class="p">(</span>
        <span class="p">{</span><span class="na">el</span><span class="p">:</span> <span class="s1">'#okta-login'</span><span class="p">},</span>
        <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{},</span>
        <span class="kd">function</span> <span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{}</span>
    <span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

<table>
  <thead>
    <tr>
      <th>Key</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>baseUrl</td>
      <td>This is your Organization URL in Okta. It will be the URL of the admin pages without the <strong>-admin</strong> for example <code class="highlighter-rouge">https://dev-123456.oktapreview.com</code></td>
    </tr>
    <tr>
      <td>clientId</td>
      <td>The client ID of the Okta application.</td>
    </tr>
    <tr>
      <td>redirectUri</td>
      <td>Where we will send the user to once they attempt a login.</td>
    </tr>
    <tr>
      <td>authParams.responseType</td>
      <td>What we want back from a successful login</td>
    </tr>
    <tr>
      <td>authParams.issuer</td>
      <td>The issuer of the authorization server. Can be retrieved from <strong>Admin -&gt; Security -&gt; API -&gt; Authorization Servers</strong></td>
    </tr>
    <tr>
      <td>authParams.display</td>
      <td>Redirect to the authorization server when an External Identity Provider button is clicked</td>
    </tr>
  </tbody>
</table>

<p>Now we can visit the <code class="highlighter-rouge">login.php</code> page and see the Sign-In Widget. You should be able to log into your main account.
If you have a successful login, you will be redirected to our <code class="highlighter-rouge">oauth2-callback.php</code> page which is where we will go
through the <a href="https://tools.ietf.org/html/rfc6749#section-1.3.1">Authorization Code Flow</a> to get our <code class="highlighter-rouge">access_token</code>.</p>

<h2 id="responding-to-a-successful-login">Responding to a Successful Login.</h2>
<p>Next, we exchange the returned authorization code for an <code class="highlighter-rouge">access_token</code>. In this sample, we will use curl to do the
exchange.</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code>$authHeaderSecret = base64_encode($clientId . ':' . $clientSecret);

$query = http_build_query([
    'grant_type' =&gt; 'authorization_code',
    'code' =&gt; $_GET['code'],
    'redirect_uri' =&gt; 'http://localhost:8000/oauth2-callback.php'
]);

$headers = [
    'Authorization: Basic ' . $authHeaderSecret,
    'Accept: application/json',
    'Content-Type: application/x-www-form-urlencoded',
    'Connection: close',
    'Content-Length: 0'
];
$url = 'https://dev-123456.oktapreview.com/oauth2/ausa87h9g2misxHVS0h7/v1/token?' . $query;

$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
curl_setopt($ch, CURLOPT_POST, 1);


$output = curl_exec($ch);
$httpcode = curl_getinfo($ch, CURLINFO_HTTP_CODE);

if(curl_error($ch))
{
	$httpcode = 500;
}
$decodedOutput = json_decode($output);
</code></pre>
</div>

<p>Now we have the <code class="highlighter-rouge">access_token</code> which we can use in our cookie to validate the user on future requests.</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code>setcookie('access_token', $decodedOutput-&gt;access_token, time() + $decodedOutput-&gt;expires_in, '/', "", false, true);
</code></pre>
</div>

<h2 id="validating-access-tokens">Validating Access Tokens</h2>

<p>Okta uses public key cryptography to sign tokens and verify that they are valid.</p>

<p>The resource server must validate the access token before allowing the client to access protected resources.</p>

<p>Access tokens are sensitive and can be misused if intercepted. Transmit them only over HTTPS and only via POST data or within request headers. If you store them on your application, you must store them securely.</p>

<p>An access token must be validated in the following manner:</p>

<ol>
  <li>Verify that the <code class="highlighter-rouge">iss</code> (issuer) claim matches the identifier of your authorization server.</li>
  <li>Verify that the <code class="highlighter-rouge">aud</code> (audience) claim is the requested URL.</li>
  <li>Verify <code class="highlighter-rouge">cid</code> (client id) claim is your client id.</li>
  <li>Verify the signature of the access token according to <a href="https://tools.ietf.org/html/rfc7515">JWS</a> using the
algorithm specified in the JWT <code class="highlighter-rouge">alg</code> header property. Use the public keys provided by Okta via the <a href="/docs/api/resources/oauth2.html#get-keys">Get Keys endpoint</a>.</li>
  <li>Verify that the expiry time (from the <code class="highlighter-rouge">exp</code> claim) has not already passed.</li>
</ol>

<div class="language-php highlighter-rouge"><pre class="highlight"><code>if($res-&gt;claims['iss'] != 'https://dev-123456.oktapreview.com/') {
    return $response-&gt;withStatus(401);
}

if($res-&gt;claims['aud'] != $oidcClientId) {
    return $response-&gt;withStatus(401);
}

if($res-&gt;claims['exp'] <span class="nt">&lt; time</span><span class="err">()</span><span class="na">-300</span><span class="err">)</span> <span class="err">{</span>
    <span class="na">return</span> <span class="err">$</span><span class="na">response-</span><span class="nt">&gt;</span>withStatus(401);
}

</code></pre>
</div>

<p>Step 4 involves downloading the public JWKS from Okta (specified by the <code class="highlighter-rouge">jwks_uri</code> property in the <a href="/docs/api/resources/oauth2.html#retrieve-authorization-server-metadata">authorization server metadata</a>. The result of this call is a <a href="https://tools.ietf.org/html/rfc7517">JSON Web Key</a> set.</p>

<p>An <code class="highlighter-rouge">id_token</code> contains a <a href="https://tools.ietf.org/html/rfc7517#section-4.5">public key id</a> (<code class="highlighter-rouge">kid</code>). To verify the signature, we use the <a href="/docs/api/resources/oidc.html#openid-connect-discovery-document">Discovery Document</a> to find the <code class="highlighter-rouge">jwks_uri</code>, which will return a list of public keys. It is safe to cache or persist these keys for performance, but Okta rotates them periodically. We strongly recommend dynamically retrieving these keys.</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code>$jwk = null;

 if($kidInCache) {
    $jwk = getKidFromCache($kid);
 }
else {

    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, 'https://dev-123456.oktapreview.com/oauth2/ausa87h9g2misxHVS0h7/v1/keys');
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_HEADER, 0);

    $output = curl_exec($ch);

    curl_close($ch);

    $output = json_decode($output);

    foreach ($output-&gt;keys as $key) {
        // poormans cache
        storeKidInCache($key-&gt;kid, $key);

        $cachedJwks[$key-&gt;kid] = $key;
        if ($key-&gt;kid == $kid) {
            $jwk = $key;
        }
    }
}
</code></pre>
</div>

<p>Once you have the <code class="highlighter-rouge">JWK</code> you can now verify the access token. Our example is using the <a href="https://packagist.org/packages/gree/jose">gree/jose</a> library.</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code>$jwt_string = 'eyJ...';
$jws = JOSE_JWT::decode($jwt_string);
$jws-&gt;verify($jwk, 'RS256');
</code></pre>
</div>

<p>Each public key is identified by a <code class="highlighter-rouge">kid</code> attribute, which corresponds with the <code class="highlighter-rouge">kid</code> claim in the <a href="/docs/api/resources/oauth2.html#token-authentication-methods">Access Token header</a>.</p>

<p>The access token is signed by an RSA private key, and we publish the future signing key well in advance.
However, in an emergency situation you can still stay in sync with Okta’s key rotation. Have your application check the <code class="highlighter-rouge">kid</code>, and if it has changed and the key is missing from the local cache, check the <code class="highlighter-rouge">jwks_uri</code> value in the <a href="/docs/api/resources/oauth2.html#retrieve-authorization-server-metadata">authorization server metadata</a> and you can go back to the <a href="/docs/api/resources/oauth2.html#get-keys">jwks uri</a> to get keys again from Okta</p>

<p>Please note the following:</p>

<ul>
  <li>For security purposes, Okta automatically rotates keys used to sign the token.</li>
  <li>The current key rotation schedule is four times a year. This schedule can change without notice.</li>
  <li>In case of an emergency, Okta can rotate keys as needed.</li>
  <li>Okta always publishes keys to the JWKS.</li>
  <li>To save the network round trip, your app can cache the JWKS response locally. The standard HTTP caching headers are used and should be respected.</li>
</ul>
<div class="beta">
<ul>
  <li>The administrator can switch the authorization server key rotation mode to <strong>MANUAL</strong> by <a href="/docs/api/resources/oauth2.html#update-authorization-server">updating the authorization server</a> and then control when to rotate the keys.</li>
</ul>
</div>

<p>Keys used to sign tokens automatically rotate and should always be resolved dynamically against the published JWKS. Your app can fail if you hardcode public keys in your applications. Be sure to include key rollover in your implementation.</p>

<h3 id="references">References</h3>

<ul>
  <li><a href="https://www.okta.com/developer/signup/">Sign Up For Okta</a></li>
  <li><a href="/docs/how-to/set-up-auth-server.html">Setting Up Authorization Server</a></li>
  <li><a href="https://github.com/nov/jose-php">Gree/Jose JWK Library</a></li>
  <li><a href="https://tools.ietf.org/html/rfc7515">JWS Spec</a></li>
  <li><a href="https://tools.ietf.org/html/rfc7519">JWT Spec</a></li>
  <li><a href="https://tools.ietf.org/html/rfc6749#section-1.3.1">Authorization Code Flow</a></li>
</ul>

      </div>
      <div class="TableOfContents TableOfContentsPreload">
        <div class="TableOfContents-item is-level1">
          <script>
                  document.write(document.title.split('|')[0].trim());
          </script>
        </div>
        <div class="TableOfContentsLoader"></div>
      </div><!-- END Page Content -->
    </section><!-- END Page Center w/Sub Nav & Content -->

    <!-- START Footer -->
    <footer class="footer">
      <div class="Wrap">
        <ul>
          <li>
            <a href="https://www.okta.com" target="_blank">Okta.com</a>
          </li>
          <li>
            <a href="/blog/">Blog</a>
          </li>
          <li>
            <a href="/docs/platform-release-notes/platform-release-notes.html">Platform Release Notes</a>
          </li>
          <li>
            <a href="/terms/">Terms & Conditions</a>
          </li>
          <li>
            <a href="/3rd_party_notices/">3rd Party Notices</a>
          </li>
          <li>
            <a href="/privacy/">Privacy Policy</a>
          </li>
          <li>
            <a href="/contact/">Contact Sales</a>
          </li>
          <li>
            <a href="mailto:developers@okta.com">Contact Support</a>
          </li>
        </ul>
        <ul>
          <li>
            <a class="icon" href="http://github.com/oktadeveloper" target="_blank"><i class="fa fa-github"></i></a>
          </li>
          <li>
            <a class="icon" href="http://twitter.com/okta" target="_blank"><i class="fa fa-twitter"></i></a>
          </li>
          <li>
            <a class="icon" href="https://devforum.okta.com/" title="Okta Developer Forums" target="_blank"><i class="fa fa-comments"></i></a>
          </li>
          <li>
            <a class="icon" href="http://feeds.feedburner.com/OktaBlog" target="_blank"><i class="fa fa-rss"></i></a>
          </li><!-- <li><a class="icon" href="http://community.okta.com" target="_blank"><i class="fa fa-comments"></i></a></li> -->
        </ul>
      </div>
    </footer>
    <script type="text/javascript" src="/assets/master-d164e3cb90ad42ea74c141546269db0efdbc2259b7d44b7f52babb60097099a8.js"></script>
    
    
    
    
      <script type="text/javascript" src="/assets/docs-a2d1c410ee8c45eaa505f76f4f72815741c3bb6532081ae1abe25e3d8d00f4fa.js"></script>
    

    <!-- END Footer -->
  </div>
  <!-- START Post Footer -->
  
  <!-- START Google Tag Manager -->
  <!-- https://support.google.com/tagmanager/answer/6103696?hl=en -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- END Google Tag Manager -->
  <!-- START Google Remarketing Tag -->
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1006913831;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
  </script>
  <div style="display:none;"><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script></div>
  <noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1006913831/?value=0&amp;guid=ON&amp;script=0"></div></noscript>
  <!-- END Google Remarketing Tag -->
  <!-- START Crazy Egg Tracking -->
  <script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0021/9333.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
  <!-- END Crazy Egg Tracking -->

  <!-- END Post Footer -->
</body>
</html>
