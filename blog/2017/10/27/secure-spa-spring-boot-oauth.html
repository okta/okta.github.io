<!doctype html>
<!--[if lt IE 7 ]> <html class="ie6 no-flexbox"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7 no-flexbox"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8 no-flexbox"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9 no-flexbox"> <![endif]-->
<!--[if IE 10 ]>    <html class="ie10 no-flexbox"> <![endif]-->
<!--[if (gt IE 10)|!(IE)]><!--> <html class="modern wf-loading" lang="en"> <!--<![endif]-->
  <head>
  <script>
    var searchDomain = 'https://developer.okta.com';
    var isProduction = window.location.hostname === 'developer.okta.com';
    if (isProduction) {
      // TypeKit
      (function(d) {
        var config = {
          kitId: 'jff5neq',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/bwf-loadingb/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);

      // Google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-15777010-3', 'auto');
      ga('send', 'pageview');

      // START Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TJ45R6');
      // END Google Tag Manager
    }
	</script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
 	

  <link type="text/css" rel="stylesheet" href="https://developer.okta.com/sites/all/themes/developer/css/master.css" media="all" />
  <meta class="swiftype" name="title" data-type="string" content="Secure your SPA with Spring Boot and OAuth | Okta Developer" />
  <meta class="swiftype" name="summary" data-type="string" content="If you have a JavaScript single-page application (SPA) that needs to securely access resources from a Spring Boot application, you likely want to use the OAu..." />

  <link type="text/css" rel="stylesheet" href="/assets/animate-ec43d72c3ed45e08a460b8a2966d8dba6006aebfa0530935c3973fa493a8771f.css">
  <link type="text/css" rel="stylesheet" href="/assets/okta-a96df4c9d48b78b618e1d541f46f7137d73d40653571e020c1ad59edd7915c60.css">
  
  
  <title>Secure your SPA with Spring Boot and OAuth | Okta Developer</title>
  <meta name="description" content="If you have a JavaScript single-page application (SPA) that needs to securely access resources from a Spring Boot application, you likely want to use the OAu...">
  <link rel="canonical" href="https://developer.okta.com/blog/2017/10/27/secure-spa-spring-boot-oauth"  data-proofer-ignore>
  <link rel="alternate" type="application/rss+xml" title="Okta Developer" href="https://developer.okta.com/feed.xml"><!-- GA -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#21313a">
  <meta name="theme-color" content="#ffffff">
</head>

  
    <body id="blog">
	




<header class="Header is-fixed">

  <div class="Wrap">

    <a class="Logo" href="https://developer.okta.com">
      <svg version="1.1" id="OktaLogo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 431.9 151.4" style="enable-background:new 0 0 431.9 151.4;" xml:space="preserve"><g><g><g><path d="M102.2,41.4c-21,0-38.1,17.1-38.1,38.1s17.1,38.1,38.1,38.1s38.1-17.1,38.1-38.1l0,0C140.3,58.5,123.2,41.4,102.2,41.4z M102.2,98.5c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19c0.1,10.5-8.4,19-18.9,19.1C102.3,98.6,102.2,98.6,102.2,98.5L102.2,98.5z"/><path d="M169.1,92.3c0-1.9,1.5-3.4,3.4-3.4c0.9,0,1.8,0.4,2.4,1c9.5,9.7,25.3,26.3,25.4,26.4c0.4,0.5,0.8,0.8,1.4,0.9l1.6,0.2h17.2c1.8,0,3.3-1.4,3.4-3.2c0-0.8-0.3-1.5-0.8-2.2l-28.6-29.2l-1.5-1.5c-3.2-3.9-2.9-5.4,0.8-9.3l22.6-25.1c1.1-1.4,0.8-3.5-0.6-4.6c-0.6-0.4-1.3-0.7-2-0.7h-17c-0.6,0.2-1.1,0.5-1.5,0.9L175,64.4c-1.3,1.4-3.4,1.5-4.8,0.2c-0.7-0.6-1.1-1.5-1.1-2.5V18.9c0-1.7-1.3-3-3-3c-0.1,0-0.2,0-0.3,0h-12.7c-2.2,0-3.3,1.5-3.3,2.8v95.8c0,2.2,1.8,2.8,3.3,2.8h12.7c1.7,0.1,3.2-1.2,3.3-2.9c0,0,0,0,0,0V92.3z"/><path d="M273,114l-1.4-12.8c-0.2-1.7-1.7-2.9-3.4-2.7c0,0,0,0-0.1,0l-2.9,0.2c-10.1,0-18.5-7.9-19-18c0-0.3,0-0.7,0-1V64.2c-0.1-2,1.5-3.6,3.5-3.7c0,0,0,0,0,0h17c1.7-0.1,3.1-1.5,3-3.2c0,0,0-0.1,0-0.1v-12c0-2.3-1.5-3.6-2.8-3.6h-17.1c-1.9,0.1-3.5-1.5-3.6-3.4c0,0,0,0,0,0V18.9c-0.1-1.7-1.5-3.1-3.2-3c0,0-0.1,0-0.1,0h-12.7c-1.6-0.1-3,1.1-3.1,2.7c0,0.1,0,0.1,0,0.2c0,0,0,61.7,0,62c0.5,21,17.9,37.6,38.9,37c1.4,0,2.9-0.2,4.3-0.3C272,117.2,273.2,115.7,273,114z"/></g><path d="M364.7,98c-10.8,0-12.4-3.8-12.4-18.3l0,0V44.8c0-1.8-1.4-3.2-3.2-3.2c0,0-0.1,0-0.1,0h-12.8c-1.8,0-3.2,1.4-3.3,3.2v1.6C314.6,36,291.3,42.5,281,60.8c-10.4,18.3-3.9,41.6,14.4,51.9c14,7.9,31.4,6.2,43.5-4.2c3.6,5.5,9.3,9.1,18.3,9.1c1.5,0,9.7,0.3,9.7-3.5v-13.6C367,99.2,366,98.1,364.7,98z M314.2,98.6c-10.5,0-19-8.5-19-19s8.5-19,19-19s19,8.5,19,19l0,0C333.2,90.1,324.7,98.6,314.2,98.6z"/></g><path d="M19.4,74c2.2-1.9,4.1-4.1,5.7-6.6c3.5-5.3,5.4-11.5,5.2-17.9V27c0-4.9,0.9-8.4,2.7-10.5c1.8-2.1,4.8-3,9.2-3h12.6c1.2,0,2.1-0.9,2.2-2.1l0,0V2.2C57,1,56,0,54.8,0c0,0,0,0,0,0H41.5c-7.8,0-12.9,2.1-18,7.6s-7.1,12.3-7.1,21.7v14.2c0,2.2-0.1,4-0.2,5.7v2.2c-0.5,3.2-1.8,6.2-3.6,8.9C9.4,64.7,5.1,70.9,0.9,74l0,0l-0.3,0.3l0,0l-0.2,0.3H0.2v0.3l0,0c-0.1,0.3-0.1,0.7,0,1l0,0v0.3h0.1l0.2,0.3l0,0l0.3,0.3l0,0c4.2,3.1,8.5,9.3,11.3,13.7c1.8,2.7,3.1,5.7,3.6,8.9v2.2c0.1,1.6,0.2,3.5,0.2,5.7v14.3c0,9.4,2.4,16.7,7.1,21.7s10.2,7.6,18,7.6h13.8c1.2,0,2.2-1,2.2-2.2V140l0,0c0-1.2-1-2.2-2.2-2.2H42.2c-4.4,0-7.5-1-9.2-3s-2.7-5.6-2.7-10.5v-22.4c0.2-6.4-1.7-12.6-5.2-17.9c-1.6-2.5-3.5-4.7-5.7-6.6l0,0c-0.9-0.7-1.1-2-0.4-2.9C19.2,74.3,19.3,74.2,19.4,74L19.4,74z"/><path d="M412.5,74c-2.2-1.9-4.1-4.1-5.7-6.6c-3.5-5.3-5.4-11.5-5.2-17.9V27c0-4.9-0.9-8.4-2.7-10.5s-4.8-3-9.2-3h-12.6c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0l0,0V2.2c0-1.2,1-2.2,2.2-2.2c0,0,0,0,0,0h13.4c7.8,0,12.9,2.1,18,7.6s7.1,12.3,7.1,21.7v14.2c0,2.2,0.1,4,0.2,5.7v2.2c0.5,3.2,1.8,6.2,3.6,8.9c2.8,4.5,7.1,10.7,11.3,13.7l0,0l0.3,0.3l0,0l0.2,0.3h0.1v0.3l0,0c0.1,0.3,0.1,0.7,0,1l0,0v0.3h-0.1l-0.2,0.3l0,0l-0.3,0.3l0,0c-4.2,3.1-8.5,9.3-11.3,13.7c-1.8,2.7-3.1,5.7-3.6,8.9v2.2c-0.1,1.6-0.2,3.5-0.2,5.7v14.3c0,9.4-2.4,16.7-7.1,21.7s-10.2,7.6-18,7.6h-13.4c-1.2,0-2.2-1-2.2-2.2c0,0,0,0,0,0V140l0,0c0-1.2,1-2.2,2.2-2.2l0,0h12.7c4.4,0,7.5-1,9.2-3s2.7-5.6,2.7-10.5v-22.4c-0.2-6.3,1.6-12.6,5.1-17.9c1.6-2.5,3.5-4.7,5.7-6.6l0,0c0.9-0.7,1.1-2,0.4-2.9C412.7,74.3,412.6,74.2,412.5,74L412.5,74z"/></g></svg>
    </a>

    <nav class="Header-nav PrimaryNav">
      <ul class="menu">
        <li class="first leaf">
          <a href="https://developer.okta.com/product/">Product</a>
        </li>
        <li class="leaf">
          <a href="https://developer.okta.com/pricing/">Pricing</a>
        </li>
        <li class="leaf">
          <a href="/blog/" class="active">Blog</a>
        </li>
        <li class="leaf">
          <a href="/documentation/">Docs</a>
        </li>
        <li class="last expanded">
          <span class="nolink">Support</span>
          <ul class="menu">
            <li class="first leaf"><a href="https://devforum.okta.com/">Okta Developer Forums</a></li>
            <li class="last leaf"><a href="mailto:developers@okta.com">developers@okta.com</a></li>
          </ul>
        </li>
      </ul>
      <a class="PrimaryNav-toggle" href="#">
        <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g class="MenuIcon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
                <path d="M1,16 L19,16" class="MenuIcon-line1" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,4 L19,4" class="MenuIcon-line2" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line3" stroke="#FFFFFF" stroke-width="2"></path>
                <path d="M1,10 L19,10" class="MenuIcon-line4" stroke="#FFFFFF" stroke-width="2"></path>
            </g>
        </svg>
        <svg class="CloseIcon" width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="ALl-Boards" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="Desktop" transform="translate(-915.000000, -235.000000)" fill="#FFFFFF">
              <g id="Search-bar-Active" transform="translate(30.000000, 26.000000)">
                <polygon id="Icon/Cross" points="901 210.6 899.4 209 893 215.4 886.6 209 885 210.6 891.4 217 885 223.4 886.6 225 893 218.6 899.4 225 901 223.4 894.6 217"></polygon>
              </g>
            </g>
          </g>
        </svg>
      </a>

      <div class="PrimaryNav-cta">
        <a target="_blank" rel="noopener noreferrer" href="https://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3Dhttps://login.okta.com/?SAMLRequest=fc%2B7CsJAEAXQXvAflu1NNJUMeZBGELTx1a%2FrYILJTtyZGD%2FfSBRiYzlw77lMnD3rSj3Qc0ku0YtgrhU6S5fSXRN9PKxmS52l00nMpq6iBvJWCrfDe4ss6vStRe9aDzmGIZfo1jsgwyWDMzUyiIV9vt1AH4XGk5ClSvewUgMNa%2BYW%2FVj5jxhm9NLP67QQaSAMu64L6CYmsFSHlnzT4ZlLwTgcL6Sf8%2FeX9AU%3D" class="Button--redOutline">Login</a>
        <a href="https://developer.okta.com/signup/" class="Button--red">Sign up</a>
      </div>

      <a class="SearchIcon" href="#"></a>
      <form id="form_search" class="SearchBar Formisimo_clocked_69929" method="get" action="https://developer.okta.com/search/" name="form_search" __bizdiag="-784164280" __biza="WJ__">
        <input type="text" name="stq" autocomplete="off" id="st-search-input-auto" class="st-search-input" placeholder="Search">
        <input type="submit" name="submit" value="GO">
      </form>

    </nav>

  </div>

</header>

	<div class="page-content">
		






<section class="Blog is-single">
		
	<div class="Blog-social">
		
		<a href="https://github.com/bdemers" target="_blank"><i class="fa fa-github"></i></a>
		
		
		<a href="https://twitter.com/briandemers" target="_blank"><i class="fa fa-twitter"></i></a>
		
		
		
		<a href="https://www.linkedin.com/in/bdemers/" target="_blank"><i class="fa fa-external-link"></i></a>
		
	</div>
	
	

<article class="BlogPost">
	
	<header class="BlogPost-header">
	
		<time class="BlogPost-date" datetime="2017-10-27">October 27, 2017</time>
		
		<h1 class="BlogPost-title">
			
			Secure your SPA with Spring Boot and OAuth
			
		</h1>
		
		<div class="BlogPost-attribution">
			
				<img src="/assets/avatar-bdemers-addbebf1a3b17c5330fd954357b4bbcdb57e5cfcab25c5267cfa8d2fc260f8a9.jpg" alt="avatar-bdemers.jpg" class="BlogPost-avatar">
			
			<span class="BlogPost-author">Brian Demers</span>
		</div>
	
	</header>
	
	<div class="BlogPost-content">
		
	<p>If you have a JavaScript single-page application (SPA) that needs to securely access resources from a Spring Boot application, you likely want to use the OAuth 2.0 implicit flow! With this flow your client will send a bearer token with each request and your server side application will verify the token with an Identity Provider (IdP). This allows your resource server to trust that your client is authorized to make the request. In OAuth terms your SPA is the client and your Spring Boot application is the Resource Server. For a more detailed explanation on the various OAuth flows take a look at our <a href="/blog/2017/06/21/what-the-heck-is-oauth">What the Heck is OAuth</a> post.</p>

<p>Today you are going to build two small applications that demonstrate these principles in action: a simple SPA client app with a little bit of JQuery and a backend service with Spring Boot. You’ll start out by using the standard Spring OAuth bits and then switch to the Okta Spring Boot Starter and check out its added features. Obviously (this is the Okta developer blog), you’ll be using Okta for your IdP, but the first sections will be vendor agnostic.</p>

<h2 id="create-a-spring-boot-application">Create a Spring Boot Application</h2>

<p>If you haven’t tried out <a href="https://start.spring.io">start.spring.io</a> go check it out right now… with a couple of clicks it will get you a basic, runnable Spring Boot Application.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>curl https://start.spring.io/starter.tgz <span class="se">\</span>
 -d <span class="nv">artifactId</span><span class="o">=</span>oauth-implicit-example  <span class="se">\</span>
 -d <span class="nv">dependencies</span><span class="o">=</span>security,web <span class="se">\</span>
 -d <span class="nv">language</span><span class="o">=</span>java <span class="se">\</span>
 -d <span class="nb">type</span><span class="o">=</span>maven-project <span class="se">\</span>
 -d <span class="nv">baseDir</span><span class="o">=</span>oauth-implicit-example <span class="se">\</span>
 | tar -xzvf -
</code></pre>
</div>

<p>If you want to download the project from your browser go to: <a href="https://start.spring.io/#!artifactId=oauth-implicit-example">start.spring.io</a> search for and select the ‘security’ dependencies then click the big green “Generate Project” button.</p>

<p>Once you have your project unzipped you should be able to start it up on the command line: with <code class="highlighter-rouge">./mvnw spring-boot:run</code>. This application won’t do anything yet, but this is a good ‘so far so good’ check. Kill the process with <code class="highlighter-rouge">^C</code> and let’s start actually writing code!</p>

<h3 id="write-some-code">Write Some Code!</h3>

<p>Well, almost. First, add the Spring OAuth 2.0 dependency to your <code class="highlighter-rouge">pom.xml</code></p>
<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>org.springframework.security.oauth<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>spring-security-oauth2<span class="nt">&lt;/artifactId&gt;</span>
   <span class="nt">&lt;version&gt;</span>2.2.0.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
</div>

<p>Open up <code class="highlighter-rouge">DemoApplication.java</code>, if you are following along (and you are right?) then this should located in <code class="highlighter-rouge">src/main/java/com/example/oauthimplicitexample</code>. It shouldn’t be hard to find, the project only contains two Java classes and one of them is a test.</p>

<p>Annotate the class with <code class="highlighter-rouge">@EnableResourceServer</code>, this will tell Spring Security to add the necessary Filters and logic to handle the OAuth implicit requests.</p>

<p>Next, add a Controller:</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageOfTheDayController</span> <span class="o">{</span>
   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/mod"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMessageOfTheDay</span><span class="o">(</span><span class="n">Principal</span> <span class="n">principal</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="s">"The message of the day is boring for user: "</span> <span class="o">+</span> <span class="n">principal</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>That is it! It’s basically hello world with an extra annotation. Start your app back up with <code class="highlighter-rouge">./mvnw spring-boot:run</code>. You should be able to hit <code class="highlighter-rouge">http://localhost:8080/mod</code>:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>curl -v http://localhost:8080/mod

HTTP/1.1 401
Content-Type: application/json;charset<span class="o">=</span>UTF-8
WWW-Authenticate: Bearer <span class="nv">realm</span><span class="o">=</span><span class="s2">"oauth2-resource"</span>, <span class="nv">error</span><span class="o">=</span><span class="s2">"unauthorized"</span>, <span class="nv">error_description</span><span class="o">=</span><span class="s2">"Full authentication is required to access this resource"</span>

<span class="o">{</span>
   <span class="s2">"error"</span>: <span class="s2">"unauthorized"</span>,
   <span class="s2">"error_description"</span>: <span class="s2">"Full authentication is required to access this resource"</span>
<span class="o">}</span>
</code></pre>
</div>

<p>A <code class="highlighter-rouge">401</code>? Yup, secure by default! Plus, we haven’t actually supplied any of the configuration detail for our OAuth IdP. Stop the server with <code class="highlighter-rouge">^C</code> and move to the next section.</p>

<h2 id="get-your-oauth-info-ready">Get Your OAuth Info Ready</h2>

<p>As I mentioned above, you’ll be using Okta going forward. You can go sign up for a free (forever) account over at <a href="https://developer.okta.com/">https://developer.okta.com/</a>. Just click the sign up button and fill out the form. When that’s done you’ll have two things, your Okta base URL, which looks something like: <code class="highlighter-rouge">dev-123456.oktapreview.com</code> and an email with instructions on how to activate your account.</p>

<p>Activate your account, and while you’re still in the Okta Developer Console you have one last step: create an Okta SPA application. On the top menu bar click on <strong>Applications</strong> then click <strong>Add Application</strong>. Select <strong>SPA</strong> and click <strong>Next</strong>.</p>

<p>Fill out the form with the following values:</p>

<ul>
  <li>Name: OAuth Implicit Tutorial</li>
  <li>Base URIs: http://localhost:8080/</li>
  <li>Login redirect URIs: http://localhost:8080/</li>
</ul>

<p>Leave everything else as the defaults and click <strong>Done</strong>. At the bottom of the next page is your <code class="highlighter-rouge">Client ID</code> which you’ll need in the next step.</p>
<h3 id="configure-oauth-for-spring">Configure OAuth for Spring</h3>

<p>The generated sample application uses an <code class="highlighter-rouge">application.properties</code> file. I prefer YAML so I’m going to rename the file to <code class="highlighter-rouge">application.yml</code>.</p>

<p>An application resource server only needs to know how to validate an access token. Since the format of the access token is not defined by the OAuth 2.0 or OIDC specs, the tokens are validated remotely.</p>

<div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="s">security</span><span class="pi">:</span>
 <span class="s">oauth2</span><span class="pi">:</span>
   <span class="s">resource</span><span class="pi">:</span>
     <span class="s">userInfoUri</span><span class="pi">:</span> <span class="s">https://dev-123456.oktapreview.com/oauth2/default/v1/userinfo</span>
</code></pre>
</div>

<p>At this point you could start up your application and start validating access tokens! But of course you would need an access token to validate…</p>

<h2 id="create-a-login-page">Create a Login Page</h2>

<p>To keep things simple you’re going to reuse your existing Spring Boot application to host your SPA. Typically these assets could be hosted somewhere else: a different application, a CDN, etc. It just seems like overkill to host a lonely index.html file in a different application for the purposes of this tutorial.</p>

<p>Create a new file <code class="highlighter-rouge">src/main/resources/static/index.html</code> and populate it with the following:</p>
<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
   <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1, shrink-to-fit=no"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">content=</span><span class="s">""</span><span class="nt">&gt;</span>
   <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"author"</span> <span class="na">content=</span><span class="s">""</span><span class="nt">&gt;</span>
   <span class="nt">&lt;title&gt;</span>Okta Implicit Spring-Boot<span class="nt">&lt;/title&gt;</span>
   <span class="nt">&lt;base</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.3.0/js/okta-sign-in.min.js"</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span>
   <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.3.0/css/okta-sign-in.min.css"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.3.0/css/okta-theme.css"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
   <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="c">&lt;!-- Render the login widget here --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"okta-login-container"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="c">&lt;!-- Render the REST response here --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"cool-stuff-here"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="c">&lt;!-- And a logout button, hidden by default --&gt;</span>
<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"logout"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-danger"</span> <span class="na">style=</span><span class="s">"display:none"</span><span class="nt">&gt;</span>Logout<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;script&gt;</span>

 <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
   <span class="na">url</span><span class="p">:</span> <span class="s2">"/sign-in-widget-config"</span><span class="p">,</span>
 <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>

   <span class="c1">// we are priming our config object with data retrieved from the server in order to make this example easier to run</span>
   <span class="c1">// You could statically define your config like if you wanted too:</span>
   <span class="cm">/*
   const data = {
     baseUrl: 'https://dev-123456.oktapreview.com',
     clientId: '00icu81200icu812w0h7',
     redirectUri: 'http://localhost:8080',
     authParams: {
       issuer: 'https://dev-123456.oktapreview.com/oauth2/default',
       responseType: ['id_token', 'token']
     }
   }; */</span>

   <span class="c1">// we want the access token so include 'token'</span>
   <span class="nx">data</span><span class="p">.</span><span class="nx">authParams</span><span class="p">.</span><span class="nx">responseType</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id_token'</span><span class="p">,</span> <span class="s1">'token'</span><span class="p">];</span>
   <span class="nx">data</span><span class="p">.</span><span class="nx">authParams</span><span class="p">.</span><span class="nx">scopes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'openid'</span><span class="p">,</span> <span class="s1">'email'</span><span class="p">,</span> <span class="s1">'profile'</span><span class="p">];</span>
   <span class="nx">data</span><span class="p">.</span><span class="nx">redirectUri</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span> <span class="c1">// simple single page app</span>
   <span class="c1">// setup the widget</span>
   <span class="nb">window</span><span class="p">.</span><span class="nx">oktaSignIn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OktaSignIn</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

   <span class="c1">// handle the rest of the page</span>
   <span class="nx">doInit</span><span class="p">();</span>
 <span class="p">});</span>

 <span class="cm">/**
  * Makes a request to a REST resource and displays a simple message to the page.
  * @param accessToken The access token used for the auth header
  */</span>
 <span class="kd">function</span> <span class="nx">doAllTheThings</span><span class="p">(</span><span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>

   <span class="c1">// include the Bearer token in the request</span>
   <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
     <span class="na">url</span><span class="p">:</span> <span class="s2">"/mod"</span><span class="p">,</span>
     <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
       <span class="s1">'Authorization'</span><span class="p">:</span> <span class="s2">"Bearer "</span> <span class="o">+</span> <span class="nx">accessToken</span>
     <span class="p">},</span>
   <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// Render the message of the day</span>
     <span class="nx">$</span><span class="p">(</span><span class="s1">'#cool-stuff-here'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">"&lt;strong&gt;Message of the Day:&lt;/strong&gt;&amp;nbsp;"</span><span class="o">+</span> <span class="nx">data</span><span class="p">);</span>
   <span class="p">})</span>
   <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// handle any errors</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"ERROR!!"</span><span class="p">);</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">error_description</span><span class="p">);</span>
   <span class="p">});</span>

   <span class="c1">// show the logout button</span>
   <span class="nx">$</span><span class="p">(</span> <span class="s2">"#logout"</span> <span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">'block'</span><span class="p">;</span>
 <span class="p">}</span>

 <span class="kd">function</span> <span class="nx">doInit</span><span class="p">()</span> <span class="p">{</span>

   <span class="nx">$</span><span class="p">(</span> <span class="s2">"#logout"</span> <span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
     <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">signOut</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
       <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
       <span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
     <span class="p">});</span>
   <span class="p">});</span>

   <span class="c1">// Check if we already have an access token</span>
   <span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'my_access_token'</span><span class="p">);</span>

   <span class="c1">// if we do great, just go with it!</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">doAllTheThings</span><span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">)</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

     <span class="c1">// otherwise show the login widget</span>
     <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">renderEl</span><span class="p">(</span>
       <span class="p">{</span><span class="na">el</span><span class="p">:</span> <span class="s1">'#okta-login-container'</span><span class="p">},</span>
       <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

         <span class="c1">// check if success</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">'SUCCESS'</span><span class="p">)</span> <span class="p">{</span>

           <span class="c1">// for our example we have the id token and the access token</span>
           <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'my_id_token'</span><span class="p">,</span> <span class="nx">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
           <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">tokenManager</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'my_access_token'</span><span class="p">,</span> <span class="nx">response</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

           <span class="c1">// hide the widget</span>
           <span class="nx">oktaSignIn</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>

           <span class="c1">// now for the fun part!</span>
           <span class="nx">doAllTheThings</span><span class="p">(</span><span class="nx">response</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">accessToken</span><span class="p">);</span>
         <span class="p">}</span>
       <span class="p">},</span>
       <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// handle any errors</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
       <span class="p">}</span>
     <span class="p">);</span>
   <span class="p">}</span>
 <span class="p">}</span>

<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<p>This page does a few things:</p>
<ul>
  <li>Displays the Okta Sign-In Widget and gets an access token</li>
  <li>Calls the <code class="highlighter-rouge">/sign-in-widget-config</code> controller to configure said widget (we are pretending this file is served by another service)</li>
  <li>Once a user is logged in, the page calls the <code class="highlighter-rouge">/mod</code> controller (with the access token)  and displays the result</li>
</ul>

<p>To support our HTML we need to create a new <code class="highlighter-rouge">Controller</code> for the <code class="highlighter-rouge">/sign-in-widget-config</code> endpoint.</p>

<p>In the same package as your Spring Boot Application class create a new <code class="highlighter-rouge">SignInWidgetConfigController</code> class:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SignInWidgetConfigController</span> <span class="o">{</span>

   <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">issuerUrl</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kd">final</span>  <span class="n">String</span> <span class="n">clientId</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">SignInWidgetConfigController</span><span class="o">(</span><span class="nd">@Value</span><span class="o">(</span><span class="s">"#{@environment['okta.oauth2.clientId']}"</span><span class="o">)</span> <span class="n">String</span> <span class="n">clientId</span><span class="o">,</span>
                                       <span class="nd">@Value</span><span class="o">(</span><span class="s">"#{@environment['okta.oauth2.issuer']}"</span><span class="o">)</span>   <span class="n">String</span> <span class="n">issuerUrl</span><span class="o">)</span> <span class="o">{</span>

       <span class="n">Assert</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">clientId</span><span class="o">,</span>  <span class="s">"Property 'okta.oauth2.clientId' is required."</span><span class="o">);</span>
       <span class="n">Assert</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">issuerUrl</span><span class="o">,</span> <span class="s">"Property 'okta.oauth2.issuer' is required."</span><span class="o">);</span>
       <span class="k">this</span><span class="o">.</span><span class="na">clientId</span> <span class="o">=</span> <span class="n">clientId</span><span class="o">;</span>
       <span class="k">this</span><span class="o">.</span><span class="na">issuerUrl</span> <span class="o">=</span> <span class="n">issuerUrl</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/sign-in-widget-config"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="n">WidgetConfig</span> <span class="nf">getWidgetConfig</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">new</span> <span class="nf">WidgetConfig</span><span class="o">(</span><span class="n">issuerUrl</span><span class="o">,</span> <span class="n">clientId</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">WidgetConfig</span> <span class="o">{</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="n">baseUrl</span><span class="o">;</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="n">clientId</span><span class="o">;</span>
       <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">authParams</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;&gt;();</span>

       <span class="n">WidgetConfig</span><span class="o">(</span><span class="n">String</span> <span class="n">issuer</span><span class="o">,</span> <span class="n">String</span> <span class="n">clientId</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">this</span><span class="o">.</span><span class="na">clientId</span> <span class="o">=</span> <span class="n">clientId</span><span class="o">;</span>
           <span class="k">this</span><span class="o">.</span><span class="na">authParams</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"issuer"</span><span class="o">,</span> <span class="n">issuer</span><span class="o">);</span>
           <span class="k">this</span><span class="o">.</span><span class="na">baseUrl</span> <span class="o">=</span> <span class="n">issuer</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"/oauth2/.*"</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
       <span class="o">}</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Add the corresponding configuration to your <code class="highlighter-rouge">application.yml</code> file:</p>

<div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="s">okta</span><span class="pi">:</span>
 <span class="s">oauth2</span><span class="pi">:</span>
   <span class="c1"># Client ID from above step</span>
   <span class="s">clientId</span><span class="pi">:</span> <span class="s">00ICU81200ICU812</span>
   <span class="s">issuer</span><span class="pi">:</span> <span class="s">https://dev-123456.oktapreview.com/oauth2/default</span>
</code></pre>
</div>

<p>The last thing is to allow public access to the <code class="highlighter-rouge">index.html</code> page and <code class="highlighter-rouge">/sign-in-widget-config</code></p>

<p>Define a <code class="highlighter-rouge">ResourceServerConfigurerAdapter</code> Bean in your Application to allow access to those resources.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">protected</span> <span class="n">ResourceServerConfigurerAdapter</span> <span class="nf">resourceServerConfigurerAdapter</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">return</span> <span class="k">new</span> <span class="nf">ResourceServerConfigurerAdapter</span><span class="o">()</span> <span class="o">{</span>
       <span class="nd">@Override</span>
       <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
           <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                   <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="s">"/index.html"</span><span class="o">,</span> <span class="s">"/sign-in-widget-config"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                   <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">();</span>
       <span class="o">}</span>
   <span class="o">};</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="fire-it-up">Fire it up!</h3>

<p>Start up your application again with <code class="highlighter-rouge">./mvnw spring-boot:run</code>, and browse to <code class="highlighter-rouge">http://localhost:8080/</code>. You should be able to log in with your new Okta account and view the message of the day.</p>

<h2 id="try-the-okta-spring-boot-starter">Try the Okta Spring Boot Starter</h2>

<p>Up until now (with the exception of the login page) you have been using using the out of the box Spring Security OAuth 2.0 support. This just works because: standards! There are a few issues with this approach:</p>
<ul>
  <li>Each request to our application requires an unnecessary round trip back to the OAuth IdP</li>
  <li>We don’t know which scopes were used when the access token was created</li>
  <li>The user’s groups/roles are not available in this context</li>
</ul>

<p>These may or may not be issues for your application, but resolving them is as simple as adding another dependency to your pom file:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>com.okta.spring<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>okta-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
   <span class="nt">&lt;version&gt;</span>0.2.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
</div>

<p>You can even trim down your <code class="highlighter-rouge">application.yml</code> file if you want to, any of the <code class="highlighter-rouge">security.*</code> properties will take precedence over the <code class="highlighter-rouge">okta.*</code> ones:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">okta</span><span class="pi">:</span>
 <span class="s">oauth2</span><span class="pi">:</span>
   <span class="s">clientId</span><span class="pi">:</span> <span class="s">00ICU81200ICU812</span>
   <span class="s">issuer</span><span class="pi">:</span> <span class="s">https://dev-123456.oktapreview.com/oauth2/default</span>
</code></pre>
</div>

<p>Restart your application and the first two concerns have been taken care of!</p>

<p>The last one requires an extra step, you will have to add extra data to Okta’s access token. We have a <a href="/blog/2017/10/13/okta-groups-spring-security">whole post on this topic</a>, but the cliff notes are as follows:</p>

<p>Head back over to the Okta Developer Console, on the menu bar click <strong>API</strong> &gt; <strong>Authorization Server</strong>. In this example we have been using the ‘default’ authorization server, so click edit, then select the ‘Claims’ tab. Click ‘Add Claim’ and fill out the form with the following values:</p>

<ul>
  <li>Name: groups</li>
  <li>Include in token type: Access Token</li>
  <li>Value type: Groups</li>
  <li>Filter: Regex - <code class="highlighter-rouge">.*</code></li>
</ul>

<p>Leave the rest as the defaults, and click ‘Create’.</p>

<p>The <code class="highlighter-rouge">okta-spring-boot-starter</code> automatically maps the values in the <code class="highlighter-rouge">groups</code> claim to Spring Security Authorities; in standard Spring Security fashion we can annotate our methods to configure access levels.</p>

<p>To enable use of the <code class="highlighter-rouge">@PreAuthorize</code> annotation you need to add the <code class="highlighter-rouge">@EnableGlobalMethodSecurity</code> to your Spring Boot Application.  If you want to validate the OAuth scopes as well, you will need to add a <code class="highlighter-rouge">OAuth2MethodSecurityExpressionHandler</code>. Just drop the following snippet in your Spring Boot Application.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@EnableGlobalMethodSecurity</span><span class="o">(</span><span class="n">prePostEnabled</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">protected</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">GlobalSecurityConfiguration</span> <span class="kd">extends</span> <span class="n">GlobalMethodSecurityConfiguration</span> <span class="o">{</span>
   <span class="nd">@Override</span>
   <span class="kd">protected</span> <span class="n">MethodSecurityExpressionHandler</span> <span class="nf">createExpressionHandler</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="k">new</span> <span class="nf">OAuth2MethodSecurityExpressionHandler</span><span class="o">();</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Finally, update <code class="highlighter-rouge">MessageOfTheDayController</code> with a <code class="highlighter-rouge">@PreAuthorize</code> (in this case you are allowing members of the group ‘Everyone’ or anyone with the ‘email’ scope).</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageOfTheDayController</span> <span class="o">{</span>
   <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/mod"</span><span class="o">)</span>
   <span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">"hasAuthority('Everyone') || #oauth2.hasScope('email')"</span><span class="o">)</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMessageOfTheDay</span><span class="o">(</span><span class="n">Principal</span> <span class="n">principal</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="s">"The message of the day is boring for user: "</span> <span class="o">+</span> <span class="n">principal</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="learn-more">Learn More!</h2>

<p>In this post, we created a standard Spring Boot + Spring Security OAuth 2.0 application that uses an OAuth implicit flow, then spiced it up with the <code class="highlighter-rouge">okta-spring-boot-starter</code> which added (without any code) support for: client side access token validation, OAuth scope support, and Okta group to authority mapping. Next time, I’ll create a sample app which uses an OAuth code-flow.</p>

<p>Want to learn more about OAuth?</p>
<ul>
  <li><a href="/blog/2017/06/21/what-the-heck-is-oauth">What the Heck is OAuth</a></li>
  <li><a href="/blog/2017/07/25/oidc-primer-part-1">An OpenID Connect Primer</a></li>
  <li><a href="https://www.oauth.com/">OAuth.net</a></li>
</ul>

<p>Questions? Comments? Cool stories about OAuth? Hit me up on Twitter <a href="https://twitter.com/briandemers">@briandemers</a> and make sure to follow my team <a href="https://twitter.com/oktadev">@oktadev</a>.</p>


	</div>
	
</article>

		
</section>

		
	</div><footer class="Footer">
    <div class="Wrap">

        <div class="Row">

            <div class="Column--3 Column--medium-6 Column--xSmall-12">

                <a class="Logo" href="https://www.okta.com/" target="_blank" rel="noopener noreferrer">
                    <img src="https://developer.okta.com/sites/all/themes/developer/images/logo-footer.png" alt="Okta">
                    Visit okta.com
                </a>

            </div>

            <div class="Column--3 Column--medium-12 Column--xSmall-12">

                <h4>Social</h4>
                <ul class="Footer-links Footer-links--social">
                    <li><a class="Footer-links--github" target="_blank" rel="noopener noreferrer" href="http://github.com/oktadeveloper">Github</a></li>
                    <li><a class="Footer-links--twitter" target="_blank" rel="noopener noreferrer" href="http://twitter.com/OktaDev">Twitter</a></li>
                    <li><a class="Footer-links--forum" target="_blank" rel="noopener noreferrer" href="https://devforum.okta.com/">Forum</a></li>
                    <li><a class="Footer-links--rss" target="_blank" rel="noopener noreferrer" href="http://feeds.feedburner.com/OktaBlog">RSS Blog</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>More Info</h4>
                <ul class="Footer-links">
                    <li><a target="_blank" href="https://developer.okta.com/integrate-with-okta/">Integrate with Okta</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/docs/platform-release-notes/platform-release-notes.html">Release Notes</a></li>
                    <li><a href="/3rd_party_notices/">3rd Party Notices</a></li>
                </ul>
            </div>

            <div class="Column--3 Column--medium-6 Column--small-12">
                <h4>Contact &amp; Legal</h4>
                <ul class="Footer-links">
                    <li><a href="https://developer.okta.com/contact/">Contact Sales</a></li>
                    <li><a target="_blank" rel="noopener noreferrer" href="mailto:developers@okta.com">Contact Support</a></li>
                    <li><a href="https://developer.okta.com/terms/">Terms &amp; Conditions</a></li>
                    <li><a href="https://developer.okta.com/privacy/">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript" src="/assets/master-0365dd27cf276cb2a15c0a43906ca592538204cf1ad4557547bf4e50609b411e.js"></script>
    <script type="text/javascript" src="/assets/myOkta-911cbafbbe079b7a5522d9cbe15bd2a5f44e1582531e88393934bec69f97696b.js"></script>
    
    
    
    
      <script type="text/javascript" src="/assets/blog-6e32dad27404131cc8630a5282264bed2ab4c08c91ac86fa496b75c53aa4f681.js"></script>
    

  <!-- START Post Footer -->
  
  <!-- START Google Tag Manager -->
  <!-- https://support.google.com/tagmanager/answer/6103696?hl=en -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- END Google Tag Manager -->
  <!-- START Google Remarketing Tag -->
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1006913831;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
  </script>
  <div style="display:none;"><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script></div>
  <noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1006913831/?value=0&amp;guid=ON&amp;script=0"></div></noscript>
  <!-- END Google Remarketing Tag -->
  <!-- START Crazy Egg Tracking -->
  <script type="text/javascript">
    setTimeout(function(){var a=document.createElement("script");
    var b=document.getElementsByTagName("script")[0];
    a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0021/9333.js?"+Math.floor(new Date().getTime()/3600000);
    a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
  <!-- END Crazy Egg Tracking -->

  <!-- END Post Footer -->
</body>
</html>
